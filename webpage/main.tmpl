<html>
<head>
<meta http-equiv="refresh" content="url=http://${hostname}:${HTTPport}">
<title>$title</title>
<script type="text/javascript" src="webpage/js/jquery-1.6.2.min.js"></script>
<script type="text/javascript" src="webpage/js/jquery-ui-1.8.16.custom.min.js"></script>
<script type="text/javascript" src="webpage/js/jquery.nestedAccordion.js"></script>
<link rel="stylesheet" type="text/css" href="webpage/css/jquery.css" />

<script type="text/javascript">
<!--//--><![CDATA[//><!--

\$.fn.accordion.defaults.container = false; 
\$(function() {
     \$("#acc1").accordion({
      obj: "div", 
      wrapper: "div", 
      el: ".h", 
      head: "h3, h4, h5", 
      next: "div", 
      initShow : "div.shown",
      standardExpansible : true
      });
    \$("#acc2").accordion({
      obj: "div", 
      wrapper: "div", 
      el: ".h", 
      head: "h3, h4, h5", 
      next: "div", 
      initShow : "div.shown",
      standardExpansible : true
      });
    \$("#acc3").accordion({
      obj: "div", 
      wrapper: "div", 
      el: ".h", 
      head: "h3, h4, h5", 
      next: "div", 
      initShow : "div.shown",
      standardExpansible : true
      });
    \$("#acc4").accordion({
      obj: "div", 
      wrapper: "div", 
      el: ".h", 
      head: "h3, h4, h5", 
      next: "div", 
      initShow : "div.shown",
      standardExpansible : true
      });

     #if $suitSessions and len($suitSessions) > 0
        #set $testSessionsNum = len($suitSessions)
        #for $i in range($testSessionsNum):
             #set $j = $i + 1
             \$("#acc5${j}").accordion({
              obj: "div", 
              wrapper: "div", 
              el: ".h", 
              head: "h3, h4, h5", 
              next: "div", 
              initShow : "div.shown",
              standardExpansible : true
              });
        #end for
       #end if
     
     \$("#acc7").accordion({
      obj: "div", 
      wrapper: "div", 
      el: ".h", 
      head: "h3, h4, h5", 
      next: "div", 
      initShow : "div.shown",
      standardExpansible : true
      });
});
//--><!]]>
</script>

<style type="text/css">
body, table {font:76%/1.6 verdana,geneva,lucida, 'lucida grande',arial,helvetica,sans-serif;}

table.desctab_big th {text-align:center; font-weight:bold; padding:4px; 
            background-color:#d0d0d0;}
table.desctab_big td {border-bottom:1px solid #a0a0a0;text-align:center; padding:2px;}

table.desctab th {text-align:center; font-weight:bold; padding:4px; 
            background-color:#e0e0e0;}

table.desctab td {text-align:center; font-weight:normal; 
                  padding:4px;border-right:1px solid #d0d0d0;}

p.sect_title {font-weight:bold; font-size:14px;}

/* --- Headings --- */
h1 {font-family:georgia,'times new roman',times,serif; font-size:2.0em; font-weight:normal; color:#f60}

h1, h2, h3, h4, h5 {margin-bottom:0.1em}

h2, h3 a, h4 a, h5 a {padding:3px 10px}

h2, h3, h4, h5 {font-size:1.1em}

/* --- Links --- */
a {padding:1px; border:0 solid #e0e0e0; color:#05b}

a, .accordion .switch a {border-width:0 0 1px 0; text-decoration:none}

.accordion a{border-width:1px; text-decoration:underline}

a:hover, a:focus, a:active {border-color:#bcd; text-decoration:none; outline:0 none}

/* --- Accordion --- */

.accordion {margin:0; padding:0 10px}

.accordion li {list-style-type:none}

.accordion li.last-child {margin-left:19px; list-style-type:disc}

#side ul.accordion ul {margin:0; padding:0 0 0 20px;}

.accordion .outer {border:1px solid #dadada; border-width:0 1px 1px; background: #fff}

.accordion .inner {margin:0px 0px 10px 0px; padding:.10em 20px 0em; overflow:hidden}

.accordion .inner .inner {padding-bottom:0}

.accordion .h {padding-top:.0em}

.accordion p {margin:.1em 0 1em}

.accordion h3 {background:#f0f0f0;}
.accordion h4 {background:#e0e0e0;}

.switch {margin-bottom:.5em}

/*  
  Add styles for all links in the 'accordion':
.accordion a {...}
*/    

a.trigger {display:block; padding-left:20px; background-image: url(../style/img/plus.gif); background-repeat: no-repeat; background-position: 1px 50%;  font-weight:700}

a.trigger.open {background-image: url(../style/img/minus.gif)}

.last-child a.trigger{padding-left:1px; background-image:none; font-weight:normal}

#a.trigger {background-color:#f0f0f0}

#a.trigger.open {border-color:#dadada; background-color:#e7e7e7}

#a:hover.trigger.open, #main a:focus.trigger.open, #main a:active.trigger.open {border-color:#bcd}

#main .switch a.open {background:transparent none}

#side a.active{font-weight:700; color:#f72; text-decoration:none}

</style>

</head>
<body>
<p>XRootD Testing Framework</p>
<div style="width:100%;" id="main">
<div style="display:block;width:48%;float:left;vertical-align:top;">
<h1>Clusters definitions</h1>
<div class="clusters-list">

<div id="acc1" class="accordion">
    #if $clusters and len($clusters) > 0
        #set $cli=1
        #for $cluster in $clusters.itervalues()
    	<h3><a href="#">${cluster.name} 
    	<span style="color:#666666;font-weight:normal;">${cluster.state}</span></a></h3>
    	<div class="inner">
	    <p class="sect_title">ACTIONS AVAILABLE</p>
        <p>&rsaquo;&nbsp; <a href="./startCluster?clusterName=${cluster.name}">Send to hypervisor and start</a></p>
    	<p class="sect_title">LAST STATE</p>
    	<table class="desctab_big" width="100%" cellspacing="0" cellpadding="0">
                <tr>
                    <th><b>State</b></th>
                </tr>
                <tr>
                    <td aligne="left">${cluster.state}</td>
                </tr>
            </table>
    	<p class="sect_title">NETWORK</p>
            <table class="desctab_big" width="100%" cellspacing="0" cellpadding="0">
                <tr>
                    <th><b>Name</b></th><th><b>Bridgename</b></th>
                    <th>IP</th><th>Netmask</th><th>DHCP range</th>
                </tr>
                <tr>
                    <td>${cluster.network.name}</td><td>${cluster.network.bridgeName}</td>
                    <td>${cluster.network.ip}</td><td>${cluster.network.netmask}</td>
                    <td>(${cluster.network.DHCPRange[0]}, ${cluster.network.DHCPRange[1]})</td>
                </tr>
            </table>
            <p class="sect_title">VIRTUAL MACHINES</p>
            <table class="desctab_big"  cellspacing="0" cellpadding="0" width="80%">
                <tr><th><b>name</b></th><th>state</th><th></th></tr>
                #if $cluster.hosts and len($cluster.hosts)>0
                    #set $hoi=1
                    #for $host in $cluster.hosts
                        <tr>
                        <td>${host.name}</td>
                        <td></td>
                        <td style="text-align:left;">
                        <div style="cursor:pointer;display:block;clear:both;
                        color:#4E92A0;" onClick="\$('#host${cli}a${hoi}').toggle()">show/hide description</div>
                        </td></tr>
                        <tr><td colspan="3">
                        #from cgi import escape
                            <div style="display:none;float:left;" id="host${cli}a${hoi}">
                            <table class="desctab" cellspacing="0" cellpadding="4">
                            <tr>
                            <th>name</th><th>mac address</th><th>ramsize</th>
                            <th>diskimage</th><th>arch</th><th>uuid</th>
                            </tr>
                            <tr><td><%= escape(host.name) %></td>
                            <td><%= escape(host.macAddress) %></td>
                            <td><%= escape(host.ramSize) %></td>
                            <td><%= escape(host.diskImage) %></td>
                            <td><%= escape(host.arch) %></td><td>uuid</td>
                            </tr>
                            </table>
                            </div>
                          </td></tr>
                        #set $hoi += 1
                    #end for
                    #set $cli += 1
                #end if
            </table>
        </div>
        #end for
    #end if
</div>
</div>
<h1>Connected hypervisors</h1>
<div id="acc2"  class="accordion">
    #if $hypervisors and len($hypervisors) > 0
        #for $hypervisor in $hypervisors.iteritems()
        <h3>${hypervisor[1].hostname} <span style="font-weight:normal;color:#666666;">[${hypervisor[0][0]}:${hypervisor[0][1]}]</span></h3>
        <div class="inner"></div>
        #end for
    #end if
</div>
<h1>Connected slaves</h1>
<div id="acc3" class="accordion">
    #if $slaves and len($slaves) > 0
        #for $slave in $slaves.iteritems()
        <h3><a href="#">&rsaquo; ${slave[1].hostname} <span style="font-weight:normal;color:#666666;">[${slave[0][0]}:${slave[0][1]}]</span></a></h3>
        <div class="inner"></div>
        #end for
    #end if
</div>
<h1>Test suits</h1>
<div id="acc4" class="accordion">
    #if $testSuits and len($testSuits) > 0
    #for $ts in $testSuits.iteritems()
        <h3>${ts[1].name}</h3>
        <div class="inner">
        <p class="sect_title">ACTIONS AVAILABLE</p>
        <p>&rsaquo;&nbsp; <a href="./initSuite?testSuiteName=${ts[1].name}">Initialize test suite <i>${ts[1].name}</i></a></p>
        <p>&rsaquo;&nbsp; <a href="./finalizeSuite?testSuiteName=${ts[1].name}">Finalize test suite  <i>${ts[1].name}</i></a></p>
        <p class="sect_title">SETTINGS</p>
        <table class="desctab_big" cellspacing="0" cellpadding="0" width="80%">
        <tr><th>Scheduler expression</th></tr>
        <tr><td>${ts[1].schedule}</td></tr>
        </table>
        <p class="sect_title">REQUIRED MACHINES</p>
         <table class="desctab_big" cellspacing="0" cellpadding="0" width="80%">
        <tr><th>Name</th><th>State</th><th></th></tr>
        #if $testSuits and len($testSuits) > 0
            #for $machine in $ts[1].machines
                <tr><td>$machine</td><td>${testMaster.slaveState($machine)}</td><td>&nbsp;</td></tr>
            #end for
        #end if
        </table>
        <p class="sect_title">TestCases</p>
        <table class="desctab_big" cellspacing="0" cellpadding="0" width="80%">
        <tr><th>Name</th><th>Actions</th><th></th></tr>
        #if $ts[1].tests and len($ts[1].tests) > 0
        #for $testname in $ts[1].tests
            <tr><td>$testname</td><td>n/a</td><td><a href="./runTestCase?testSuiteName=${ts[1].name}&testName=$testname">RUN</a></td></tr>
        #end for
        #end if
        </table>
        <p class="sect_title">SESSIONS</p>
    #if $suitSessions.has_key(ts[1].name)
        <table class="desctab_big" cellspacing="0" cellpadding="0" width="80%">
        <tr><th>Name</th><th>State</th></tr>
        <tr><td>${suitSessions[$ts[1].name].state}</td><td>&nbsp;</td></tr>
        </table>
    #end if
        </div>
    #end for
    #end if
</div>
</div>
#set $testSessionsNum = 1
#set $testCasesNum = 1
<div style="display:block;width:48%;float:right;">
    <h1>TEST CASES [loaded or finished; grouped by test suits]</h1>

    #if $suitSessions and len($suitSessions) > 0
    #for $suitSess in $suitSessions.itervalues()
        <div id="acc5${testSessionsNum}" class="accordion">
        <h3><a href="#">${suitSess.suiteName} <span style="font-weight:normal;">[testsuite: ${suitSess.suiteName}]</span></a></h3>
        <div class="inner">
        #if $suitSess.cases and len($suitSess.cases) > 0
        #for $tC in $suitSess.getAllCases()
            <h4><a href="#">${tC.name} <span style="font-weight:normal;">[${suitSess.suiteName}]</span></a></h4>
            <div class="inner">
                #set $stages=$suitSess.getStages4TestCase($tC.name)
                #set iS = 1
                #for $stage in $stages
                    #set $color = "#222222"
                    #if $stage[0].id < 0:
                        #set $color = "#dd0000"
                    #end if
                    <p style="color:$color;">${stage[0]} 
                    <a href="#" id="${tC.uid}_st${iS}_button">see details</a></p>
                    <div id="${tC.uid}_st${iS}_details" style="display:none;"
                    title="Details of test result stage at slave ${stage[3]}">
                    <table>
                    <tr><td style="background:#e0e0e0;">state</td></tr>
                    <tr><td>${stage[0]}</td></tr>
                    <tr><td style="background:#e0e0e0;">return code</td></tr>
                    <tr><td>${stage[1][2]}</td></tr>
                    <tr><td style="background:#e0e0e0;">stdout</td></tr>
                    <tr><td>${stage[1][0]}</td></tr>
                    <tr><td style="background:#e0e0e0;">stderr</td></tr>
                    <tr><td>${stage[1][1]}</td></tr>
                    </table>
                    </div>
                    <script style="display:none;">
                    \$( "#${tC.uid}_st${iS}_button" ).click(function() {
                        \$( "#${tC.uid}_st${iS}_details" ).dialog({
                            height: 500,
                            width: 300,
                            modal: true
                        });
                    });
                    </script>
                    #set $iS += 1
                #end for
            </div>
            #set $testCasesNum += 1
        #end for
        #else
           <p>No test cases has been run in this session yet.</p>
        #end if
        </div>
        </div>
        #set $testSessionsNum += 1
    #end for
    #end if
    </div>
</div>
<div style="display:block;width:48%;float:right;">
    <h1>ALL LOG MESSAGES</h1>
    <div id="acc7" class="accordion" style="background-color:#ffffff;background-image:none;">
        #if $userMsgs and len($userMsgs) > 0
            <h3>Messages (last 15)</h3>
            <div class="inner">
            #set $iM = 1
            #set $mLen = len($userMsgs)-16
            
            #for $userMsg in $userMsgs
                #if $iM>$mLen
                    #set $color = "#222222"
                    #if $userMsg.levelno == logging.WARNING
                        #set $color = "#587498"
                    #end if
                    #if $userMsg.levelno == logging.ERROR
                        #set $color = "#E86850"
                    #end if
                    <p style="color:$color;">${iM}. ${userMsg.getMessage()}</p>
                #end if
                #set $iM += 1
            #end for
            </div>
        #end if
    </div>
</div>
</div>
</body>
</html>