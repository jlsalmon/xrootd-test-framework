<!doctype html>
<html lang="en" class="no-js">
    <head>
        <title>${title}</title>
        <meta charset="UTF-8">
        <meta name="description" content="${title}">
        <meta name="author" content="Justin Salmon <jsalmon@cern.ch>">

        <link rel="shortcut icon" href="/webpage/img/favicon.ico">

        <!-- CSS Styles -->
        <link rel="stylesheet" href="/webpage/css/style.css">
        <link rel="stylesheet" href="/webpage/css/colors.css">
        <link rel="stylesheet" href="/webpage/css/jquery.tipsy.css">
        <link rel="stylesheet" href="/webpage/css/jquery.datatables.css">
        <link rel="stylesheet" href="/webpage/css/jquery.nyromodal.css">
        <link rel="stylesheet" href="/webpage/css/jquery.datepicker.css">

        <!-- Google WebFonts -->
        <link href='http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>

        <script src="/webpage/js/libs/modernizr-1.7.min.js"></script>
    </head>
    #import re
    
    #set $nt = len($testsuites)
    #set $nc = len($clusters)
    #set $nh = len($hypervisors)
    #set $ns = len($slaves)
    
    #set $run_hist = sorted($run_hist, key=lambda x: $x.initDate, reverse=True)
    
    #set $failed_runs = len([run for run in $run_hist if $run.failed])
    #set $success_runs = len($run_hist) - $failed_runs
    
    #def get_case_init_stages($all_stages)
        #set $init_stages = []
        #for $stage in $all_stages
            #if re.match('^\[..:..:..\] Initializing.*', $stage[1][0])
                $init_stages.append($stage)
            #end if
        #end for
        #return $init_stages
    #end def
    
    #def get_case_run_stages($all_stages)
        #set $run_stages = []
        #for $stage in $all_stages
            #if re.match('^\[..:..:..\] Running.*', $stage[1][0])
                $run_stages.append($stage)
            #end if
        #end for
        #return $run_stages
    #end def
    
    #def get_case_finalize_stages($all_stages)
        #set $finalize_stages = []
        #for $stage in $all_stages
            #if re.match('^\[..:..:..\] Finalizing.*', $stage[1][0])
                $finalize_stages.append($stage)
            #end if
        #end for
        #return $finalize_stages
    #end def
    
    
    <!-- Add class .fixed for fixed layout. You would need also edit CSS file for width -->
    <body>

        <!-- Fixed Layout Wrapper -->
        <div class="fixed-wrapper">

            <!-- Aside Block -->
            <section role="navigation">
                <header>
                    <h1><a href="index" title="Back to Homepage"></a>XRootD</h1>
                    <h2>Testing Framework</h2>
                </header>

                <!-- Main Navigation -->
                <nav id="main-nav">
                    <ul>
                        <!-- Use class .no-submenu to open link instead of a sub menu-->
                        <!-- Use class .current to open submenu on page load -->
                        <li>
                            <a href="/index" class="dashboard no-submenu">Dashboard</a>
                        </li>
                        <li class="current">
                            <a href="/testsuites" class="projects no-submenu">Test Suites</a>
                            <span title="${nt} defined test suite(s)">$nt</span>
                            #if len($testsuites)
	                            <ul>
		                            #for $ts_name in $testsuites.iterkeys()
		                                <li><a href="/testsuites/${ts_name}">$ts_name</a></li>
		                            #end for
	                            </ul>
                            #end if
                        </li>
                        <li>
                            <a href="/clusters" class="products no-submenu">Clusters</a>
                            <span title="${nc} defined cluster(s)">$nc</span>
                        </li>
                        <li>
                            <a href="/hypervisors" class="articles no-submenu">Hypervisors</a>
                            <span title="${nh} connected hypervisor(s)">$nh</span>
                        </li>
                        <li>
                            <a href="/slaves" class="settings no-submenu">Slaves</a>
                            <span title="${ns} connected slave(s)">$ns</span>
                        </li>
                    </ul>
                </nav>
                <!-- /Main Navigation -->

            </section>
            <!-- /Aside Block -->

            <!-- Main Content -->
            <section role="main">

                <!-- Breadcrumbs -->
                <ul id="breadcrumbs">
                    <li><a href="/index" title="Back to Homepage">Back to Home</a></li>
                    <li><a href="/index">Dashboard</a></li>
                    <li><a href="/testsuites">Test Suites</a></li>
                    <li>$testsuite.name</li>
                </ul>
                <!-- /Breadcrumbs -->

                <!-- Full Content Block -->
                <!-- Note that only 1st article need clearfix class for clearing -->
                <article class="full-block clearfix">

                    <!-- Article Container for safe floating -->
                    <div class="article-container">

                        <header>
                            <h2>$testsuite.name</h2>
                            <!-- Article Header Tab Navigation -->
                            <nav>
                                <ul class="tab-switch">
                                    <li><a class="default-tab" href="#tab0">Run History</a></li>
                                    <li><a href="#tab1">Definition</a></li>
                                </ul>
                            </nav>
                            <!-- /Article Header Tab Navigation -->

                        </header>
                        <!-- /Article Header -->

                        <!-- Article Content -->
                        <section>
                            <!-- Tab Content -->
                            <div class="tab default-tab" id="tab0">
                                #if len($run_hist)
                                    <div class="sidetabs">
                                    
                                    <!-- Side Tab Navigation -->
                                    <nav class="sidetab-switch">
                                        <ul>
                                            #for $i, $run in enumerate($run_hist)
                                                #set $default_tab = ''
                                                #set $state = 'failure'
                                                
                                                #if $i == 0
                                                    #set $default_tab = 'default-sidetab'
                                                #end if
                                                
                                                #if not $run.failed
                                                    #set $state = 'success'
                                                #end if
                                                <li class="${state}"><a class="${default_tab}" href="#sidetab-outer-${run.uid}">$run.initDate.strftime("%d-%m-%Y %H:%M:%S")</a></li>
                                            #end for
                                        </ul>
                                    </nav>
                                #else
                                    <div class="notification note">
                                        <p>
                                            <strong>Note:</strong> No historical runs for this test suite.
                                        </p>
                                    </div>
                                #end if
                                    
                                    <!-- /Side Tab Navigation -->
                                    
                                    #if len($run_hist)           
                                        #for $i, $run in enumerate($run_hist)
                                            #set $default_class = ''
                                            #if $i == 0
                                                #set $default_class = 'default-sidetab'
                                            #end if
                                            
                                            <div class="sidetab ${default_class}" id="sidetab-outer-${run.uid}">
                                                <div class="widgets">
		                                            <div class="widget increase" id="successes">
		                                                <span>$success_runs</span>
		                                                <p>Successful Run(s)</p>
		                                            </div>
		                                            
		                                            <div class="widget decrease" id="failures">
		                                                <span>$failed_runs</span>
		                                                <p>Failed Run(s)</p>
		                                            </div>
		                                        </div>
		                                        
                                                <h4>Run: <span>$run.initDate.strftime("%a %d-%m-%Y %H:%M:%S")</span></h4>
		                                        <header class="square">
						                            <!-- Article Header Tab Navigation -->
						                            <nav class="leftnav">
						                                <ul class="tab-switch">
						                                    #set $state = 'success'
						                                    #set $init_stages = $run.getTestCaseStages("suite_inited")
                                                            #for $s in $init_stages
                                                                #if $s[1][2] != "0"
                                                                    #set $state = 'failure'
                                                                #end if
                                                            #end for
                                                            <li class="$state"><a class="default-tab" href="#tab-suite-init-${run.uid}">Suite Initialization</a></li>
                                                            
                                                            #for $i, $case in enumerate($run.cases.itervalues())
                                                                #set $case_stages = $run.getTestCaseStages($case.uid)
                                                                
                                                                #set $state = 'success'
                                                                #for $case_stage in $case_stages
                                                                    #if $case_stage[1][2] != "0"
                                                                        #set $state = 'failure'
                                                                    #end if
                                                                #end for
                                                                <li class="$state"><a href="#tab-case-run-${case.uid}">Test Case: <strong>$case.name</strong></a></li>
                                                            #end for
                                                            
                                                            #set $state = 'success'
                                                            #set $fin_stages = $run.getTestCaseStages("suite_finalized")
                                                            #for $s in $fin_stages
                                                                #if $s[1][2] != "0"
                                                                    #set $state = 'failure'
                                                                #end if
                                                            #end for
                                                            <li class="$state"><a href="#tab-suite-fin-${run.uid}">Suite Finalization</a></li>
						                                </ul>
						                            </nav>
		                                        </header>
		                                        
		                                        <section>
		                                            <div class="tab default-tab" id="tab-suite-init-${run.uid}">
		                                            
		                                              #if len($run.cases)
                                                           #set $init_stages = $run.getTestCaseStages("suite_inited") 
                                                           #if $init_stages and len($init_stages)
                                                           
                                                           <div class="sidetabs">
			                                                    <nav class="sidetab-switch">
			                                                        <ul>
			                                                            #for $i, $stage in enumerate($init_stages)
			                                                                #set $default_class = ''
			                                                                #set $state = 'failure'
			                                                                
			                                                                #if $i == 0
			                                                                    #set $default_class = 'default-sidetab'
			                                                                #end if
			                                                                
			                                                                #if $stage[1][2] == "0"
			                                                                    #set $state = 'success'
			                                                                #end if
			                                                                
			                                                                <li class="$state">
			                                                                <a href="#sidetab-inner-suite-init-${stage[3]}-${run.uid}" class="$default_class">$stage[3]</a>
			                                                                </li>
			                                                            
			                                                            #end for
			                                                        </ul>
			                                                    </nav>
				                                                
				                                                <section>
                                                                #for $i, $stage in enumerate($init_stages)
                                                                    #set $default_class = ''
                                                                    #if $i == 0
                                                                        #set $default_class = 'default-sidetab'
                                                                    #end if
                                                                    <div class="sidetab $default_class" id="sidetab-inner-suite-init-${stage[3]}-${run.uid}">        
                                                                        <article class="full-block nested light">                                       
	                                                                        <div class="article-container">
	                                                                           <section>
	                                                                              <br />
	                                                                              #set $stdout = $stage[1][0].decode('latin-1')    
	                                                                              <code>$stdout</code>
	                                                                              
	                                                                           </section>
	                                                                        </div>
                                                                        </article>     
                                                                    </div>
                                                                    
                                                                #end for
                                                                </section>
                                                           </div>
                                                           #end if                    
                                                      #end if

			                                        </div>   
			                                        
			                                        #for $i, $case in enumerate($run.cases.itervalues())
                                                        #set $case_stages = $run.getTestCaseStages($case.uid)
                                                        
                                                        
                                                        <div class="tab" id="tab-case-run-${case.uid}">

                                                            <header class="square">
		                                                        <nav class="leftnav">
		                                                              <ul class="tab-switch">
		                                                                  #set $state = 'success'
                                                                          #set $init_stages = self.get_case_init_stages($case_stages)
		                                                                  #for $stage in $init_stages
		                                                                      #if $stage[1][2] != "0"
		                                                                          #set $state = 'failure'
		                                                                      #end if
		                                                                  #end for
		                                                                  <li class="$state">
		                                                                      <a href="#tab-inner-case-init-${case.uid}" class="default-tab">Case Initialization</a>
		                                                                  </li>
		                                                                  
		                                                                  #set $state = 'success'
                                                                          #set $run_stages = self.get_case_run_stages($case_stages)
                                                                          #for $stage in $run_stages
                                                                              #if $stage[1][2] != "0"
                                                                                  #set $state = 'failure'
                                                                              #end if
                                                                          #end for
		                                                                  <li class="$state">
		                                                                      <a href="#tab-inner-case-run-${case.uid}">Case Run</a>
		                                                                  </li>
		                                                                  
		                                                                  #set $state = 'success'
                                                                          #set $fin_stages = self.get_case_finalize_stages($case_stages)
                                                                          #for $stage in $fin_stages
                                                                              #if $stage[1][2] != "0"
                                                                                  #set $state = 'failure'
                                                                              #end if
                                                                          #end for
		                                                                  <li class="$state">
		                                                                      <a href="#tab-inner-case-fin-${case.uid}">Case Finalization</a>
		                                                                  </li>
		                                                                  
		                                                              </ul>
		                                                        </nav>
	                                                        </header> 
                                                            
                                                            <section>
	                                                            <div class="tab default-tab" id="tab-inner-case-init-${case.uid}">
		                                                            <div class="sidetabs">
		                                                                <nav class="sidetab-switch">
		                                                                    <ul>
		                                                                        #set $init_stages = self.get_case_init_stages($case_stages)

		                                                                        #for $i, $stage in enumerate($init_stages)
		                                                                            #set $state = 'success'
		                                                                            #if $stage[1][2] != "0"
		                                                                               #set $state = 'failure'
		                                                                            #end if
		                                                                            
		                                                                            #set $default_tab = ''
						                                                            #if $i == 0
						                                                               #set $default_tab = 'default-tab'
						                                                            #end if

                                                                                    <li class="$state">
                                                                                       <a href="#sidetab-inner-case-init-${stage[3]}-${case.uid}">$stage[3]</a>
                                                                                    </li>

		                                                                        #end for
		                                                                    </ul>
		                                                                </nav>
		                                                                
		                                                                <section>
		                                                                    #set $init_stages = self.get_case_init_stages($case_stages)
		                                                                    
		                                                                    #for $i, $stage in enumerate($init_stages)
		                                                                              
	                                                                            #set $default_tab = ''
                                                                                #if $i == 0
                                                                                   #set $default_tab = 'default-sidetab'
                                                                                #end if
                                                                                   
	                                                                            <div class="sidetab $default_tab" id="sidetab-inner-case-init-${stage[3]}-${case.uid}">
	                                                                                <article class="full-block nested light">                                       
	                                                                                    <div class="article-container">
	                                                                                    
	                                                                                        <section>
	                                                                                            <br />
	                                                                                            <code>$stage[1][0]</code>
	                                                                                        </section>
	                                                                                    
	                                                                                    </div>
	                                                                                </article>
	                                                                            </div>
		                                                                            
		                                                                    #end for
		                                                                </section>
		                                                            </div>
	                                                            </div>
		                                                        
		                                                        <div class="tab" id="tab-inner-case-run-${case.uid}">
	                                                                <div class="sidetabs">
	                                                                    <nav class="sidetab-switch">
	                                                                        <ul>
	                                                                            #set $run_stages = self.get_case_run_stages($case_stages)

                                                                                #for $i, $stage in enumerate($run_stages)
                                                                                    #set $state = 'success'
                                                                                    #if $stage[1][2] != "0"
                                                                                       #set $state = 'failure'
                                                                                    #end if
                                                                                    
                                                                                    #set $default_tab = ''
                                                                                    #if $i == 0
                                                                                       #set $default_tab = 'default-tab'
                                                                                    #end if

                                                                                    <li class="$state">
                                                                                       <a href="#sidetab-inner-case-run-${stage[3]}-${case.uid}">$stage[3]</a>
                                                                                    </li>

                                                                                #end for
	                                                                        </ul>
	                                                                    </nav>
	                                                                    
	                                                                    <section>
	                                                                        #set $run_stages = self.get_case_run_stages($case_stages)
                                                                            
                                                                            #for $i, $stage in enumerate($run_stages)
                                                                                      
                                                                                #set $default_tab = ''
                                                                                #if $i == 0
                                                                                   #set $default_tab = 'default-sidetab'
                                                                                #end if
                                                                                   
                                                                                <div class="sidetab $default_tab" id="sidetab-inner-case-run-${stage[3]}-${case.uid}">
                                                                                    <article class="full-block nested light">                                       
                                                                                        <div class="article-container">
                                                                                        
                                                                                            <section>
                                                                                                <br />
                                                                                                <code>$stage[1][0]</code>
                                                                                            </section>
                                                                                        
                                                                                        </div>
                                                                                    </article>
                                                                                </div>
                                                                                    
                                                                            #end for
	                                                                    </section>
	                                                                </div>
	                                                            </div>
	                                                            
	                                                            <div class="tab" id="tab-inner-case-fin-${case.uid}">
	                                                                <div class="sidetabs">
	                                                                    <nav class="sidetab-switch">
	                                                                        <ul>
	                                                                            #set $fin_stages = self.get_case_finalize_stages($case_stages)

                                                                                #for $i, $stage in enumerate($fin_stages)
                                                                                    #set $state = 'success'
                                                                                    #if $stage[1][2] != "0"
                                                                                       #set $state = 'failure'
                                                                                    #end if
                                                                                    
                                                                                    #set $default_tab = ''
                                                                                    #if $i == 0
                                                                                       #set $default_tab = 'default-tab'
                                                                                    #end if

                                                                                    <li class="$state">
                                                                                       <a href="#sidetab-inner-case-fin-${stage[3]}-${case.uid}">$stage[3]</a>
                                                                                    </li>

                                                                                #end for
	                                                                        </ul>
	                                                                    </nav>
	                                                                    
	                                                                    <section>
	                                                                        #set $fin_stages = self.get_case_finalize_stages($case_stages)
                                                                            
                                                                            #for $i, $stage in enumerate($fin_stages)
                                                                                      
                                                                                #set $default_tab = ''
                                                                                #if $i == 0
                                                                                   #set $default_tab = 'default-sidetab'
                                                                                #end if
                                                                                   
                                                                                <div class="sidetab $default_tab" id="sidetab-inner-case-fin-${stage[3]}-${case.uid}">
                                                                                    <article class="full-block nested light">                                       
                                                                                        <div class="article-container">
                                                                                        
                                                                                            <section>
                                                                                                <br />
                                                                                                <code>$stage[1][0]</code>
                                                                                            </section>
                                                                                        
                                                                                        </div>
                                                                                    </article>
                                                                                </div>
                                                                                    
                                                                            #end for
	                                                                    </section>
	                                                                </div>
	                                                            </div>
                                                            </section>

                                                        </div>  
                                                        
                                                    #end for
                                                    
                                                    <div class="tab" id="tab-suite-fin-${run.uid}">
                                                        #if len($run.cases)
                                                           #set $fin_stages = $run.getTestCaseStages("suite_finalized") 
                                                           #if $fin_stages and len($fin_stages)
                                                           
                                                           <div class="sidetabs">
                                                                <nav class="sidetab-switch">
                                                                    <ul>
                                                                        #for $i, $stage in enumerate($fin_stages)
                                                                            #set $default_class = ''
                                                                            #set $state = 'failure'
                                                                            
                                                                            #if $i == 0
                                                                                #set $default_class = 'default-sidetab'
                                                                            #end if
                                                                            
                                                                            #if $stage[1][2] == "0"
                                                                                #set $state = 'success'
                                                                            #end if
                                                                            
                                                                            <li class="$state">
                                                                            <a href="#sidetab-inner-suite-fin-${stage[3]}-${run.uid}" class="$default_class">$stage[3]</a>
                                                                            </li>
                                                                        
                                                                        #end for
                                                                    </ul>
                                                                </nav>
                                                                
                                                                <section>
                                                                #for $i, $stage in enumerate($fin_stages)
                                                                    #set $default_class = ''
                                                                    #if $i == 0
                                                                        #set $default_class = 'default-sidetab'
                                                                    #end if
                                                                    <div class="sidetab $default_class" id="sidetab-inner-suite-fin-${stage[3]}-${run.uid}">        
                                                                        <article class="full-block nested light">                                       
                                                                            <div class="article-container">
                                                                               <section>
                                                                                  <br />
                                                                                  #set $stdout = $stage[1][0].decode('latin-1')    
                                                                                  <code>$stdout</code>
                                                                                  
                                                                               </section>
                                                                            </div>
                                                                        </article>     
                                                                    </div>
                                                                    
                                                                #end for
                                                                </section>
                                                           </div>
                                                           #end if                    
                                                      #end if
                                                    </div>    
		                                        </section>                              
		                                        
                                            </div>
                                            
                                        #end for
                                    #end if
                                    
                                </div>
                            </div>
                            <!-- /Tab Content -->
                            
                            <!-- Tab Content -->
                            <div class="tab" id="tab1">
                                def
                            </div>
                            <!-- /Tab Content -->

                        </section>
                        <!-- /Article Content -->

                    </div>
                    <!-- /Article Container -->

                </article>
                <!-- /Full Content Block -->

            </section>
            <!-- /Main Content -->

        </div>
        <!-- /Fixed Layout Wrapper -->


        <!-- JS Libs at the end for faster loading -->
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
        <script>!window.jQuery && document.write(unescape('%3Cscript src="/webpage/js/jquery/jquery-1.5.1.min.js"%3E%3C/script%3E'))</script>
        <script src="/webpage/js/jquery/jquery.nyromodal.js"></script>
        <script src="/webpage/js/jquery/jquery.tipsy.js"></script>
        <script src="/webpage/js/jquery/jquery.datatables.js"></script>
        <script src="/webpage/js/jquery/jquery.datepicker.js"></script>
        <script src="/webpage/js/script.js"></script>

    </body>
</html>